/*!
 * traviso.js - v0.1.4
 * Copyright (c) 2021, Hakan Karlidag - @axaq
 * www.travisojs.com
 *
 * Compiled: Wed, 26 May 2021 11:16:09 UTC
 *
 * traviso.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var TRAVISO=function(t,e){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},r=function(t){return null!=t},a=function(t,e,i,n,o,r){if(r){if(t<e)return n;if(t>i)return o}return n+(o-n)*(t-e)/(i-e)},s=function(t,e){var i,n,o=t.y,r=t.x,a=e.length,s=!1;for(i=0,n=a-1;i<a;n=i++)e[i][1]>o!=e[n][1]>o&&r<(e[n][0]-e[i][0])*(o-e[i][1])/(e[n][1]-e[i][1])+e[i][0]&&(s=!s);return s},h=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},l=0,c=1,g=2,p=3,u=4,f=5,d=6,m=7,b=8,v=["idle","idle_s","idle_sw","idle_w","idle_nw","idle_n","idle_ne","idle_e","idle_se","move_s","move_sw","move_w","move_nw","move_n","move_ne","move_e","move_se"],y=1,T=!0;function C(t){T&&self.console.log("TRAVISO: "+t)}function w(t){return void 0===t&&(t=!0),T=t}var O=function(t,i,n){var o=t.mapData.objects[i];if(o){var r=null,a=o.textureNames[n];if(a&&a.length>0){r=[];for(var s=0;s<a.length;s++)r[r.length]=e.Texture.from(a[s])}else C("No textures defined for object type: "+i+" and visualId: "+n);return r}throw new Error("TRAVISO: No info defined for object type: "+i)},P=function(t){function i(i,n,o){void 0===o&&(o=.5);var r=t.call(this)||this;r.onContainerAnimComplete_delayed_binded=r.onContainerAnimComplete_delayed.bind(r),r.onContainerAnimComplete_binded=r.onContainerAnimComplete.bind(r),r.engine=i,r.type=n;var a=function(t,e){var i=t.mapData.objects[e];if(i){var n={};for(var o in i.textureNames)Object.prototype.hasOwnProperty.call(i.textureNames,o)&&(n[o]=O(t,e,o));return{m:i.m,i:i.i,f:i.f,nt:i.nt,t:n,io:i.io,s:i.s,rowSpan:i.rowSpan,columnSpan:i.columnSpan}}throw new Error("TRAVISO: No info defined for object type: "+e)}(r.engine,r.type);r.isMovableTo=a.m,r.isInteractive=a.i,r.interactive=r.interactiveChildren=!1,r.isFloorObject=a.f,r.noTransparency=a.nt,r.rowSpan=a.rowSpan,r.columnSpan=a.columnSpan;var s=r.rowSpan/(r.columnSpan+r.rowSpan);return r.textures=a.t,r.interactionOffsets=a.io,r.currentInteractionOffset=r.interactionOffsets.idle,r.container=new e.AnimatedSprite(r.textures.idle),r.container.interactive=r.container.interactiveChildren=!1,r.container.anchor.x=s,r.container.anchor.y=1,r.addChild(r.container),r.animSpeed=o,r.container.gotoAndStop(0),r}return n(i,t),Object.defineProperty(i.prototype,"animSpeed",{get:function(){return this.container.animationSpeed},set:function(t){this.container.animationSpeed=r(t)&&t>0?t:.5},enumerable:!1,configurable:!0}),i.prototype.changeVisualToDirection=function(t,e,i,n,o,r){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===o&&(o=null),void 0===r&&(r=null),this.changeVisual(e?v[t+8]:function(t){return v[t]}(t),i,n,o,r))this.currentDirection=t;else{if(!this.changeVisual("idle",i,n,o,r))throw new Error("no 'idle' visual defined as backup for object type "+this.type);this.currentDirection=l}},i.prototype.changeVisual=function(t,e,i,n,o){return void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===o&&(o=null),!!this.textures[t]&&(this.currentInteractionOffset=this.interactionOffsets[t],this.container.textures!==this.textures[t]||i?(this.container.textures=this.textures[t],!e&&this.textures[t].length>1?(this.container.loop=!i,i&&n&&(this.onContainerAnimCompleteCallback=n,this.container.onComplete=this.onContainerAnimComplete_binded),r(o)&&o>0&&(this.animSpeed=o),this.container.gotoAndPlay(0)):this.container.gotoAndStop(0),this.engine.objectUpdateCallback&&this.engine.objectUpdateCallback(this),!0):(this.container.loop=!i,r(o)&&o>0&&(this.animSpeed=o),!0))},i.prototype.onContainerAnimComplete=function(){setTimeout(this.onContainerAnimComplete_delayed_binded,100)},i.prototype.onContainerAnimComplete_delayed=function(){this.onContainerAnimCompleteCallback(this),this.onContainerAnimCompleteCallback=null},i.prototype.destroy=function(){this.container&&(this.engine=null,this.textures=null,this.container.onComplete=null,this.container=null)},i}(e.Container),j=function(t){function i(i,n){var o=t.call(this)||this;o.isHighlighted=!1,o.onHighlightTweenEnd_binded=o.onHighlightTweenEnd.bind(o),o.engine=i,o.type=n;var r=o.engine.TILE_HALF_H,a=o.engine.TILE_HALF_W;o.vertices=[[-a,0],[0,-r],[a,0],[0,r]];var s=function(t,i){var n=t.mapData.tiles[i];if(n)return{m:n.movable,t:n.path?[e.Texture.from(n.path)]:[]};if(t.mapData.singleGroundImage)return{m:parseInt(i)>0,t:[]};throw new Error("TRAVISO: No info defined for tile type: "+i)}(o.engine,o.type);if(o.isMovableTo=s.m,s.t.length>0&&(o.tileGraphics=new e.AnimatedSprite(s.t),o.tileGraphics.anchor.x=.5,o.tileGraphics.anchor.y=.5,o.addChild(o.tileGraphics),o.tileGraphics.gotoAndStop(parseInt(o.type))),o.engine.mapData.tileHighlightImage)o.highlightedOverlay=new e.Sprite(e.Texture.from(o.engine.mapData.tileHighlightImage.path)),o.highlightedOverlay.anchor.x=.5,o.highlightedOverlay.anchor.y=.5,o.addChild(o.highlightedOverlay);else{o.highlightedOverlay=new e.Graphics,o.highlightedOverlay.clear(),o.highlightedOverlay.lineStyle(o.engine.tileHighlightStrokeAlpha<=0?0:2,o.engine.tileHighlightStrokeColor,o.engine.tileHighlightStrokeAlpha),o.highlightedOverlay.beginFill(o.engine.tileHighlightFillColor,o.engine.tileHighlightFillAlpha),o.highlightedOverlay.moveTo(o.vertices[0][0],o.vertices[0][1]);for(var h=1;h<o.vertices.length;h++)o.highlightedOverlay.lineTo(o.vertices[h][0],o.vertices[h][1]);o.highlightedOverlay.lineTo(o.vertices[0][0],o.vertices[0][1]),o.highlightedOverlay.endFill(),o.addChild(o.highlightedOverlay)}return o.highlightedOverlay.scale.x=o.highlightedOverlay.scale.y=.1,o.highlightedOverlay.visible=!1,o}return n(i,t),i.prototype.setHighlighted=function(t,e){if(this.isHighlighted!==t){if(e)return this.highlightedOverlay.scale.x=this.highlightedOverlay.scale.y=t?1:.1,this.highlightedOverlay.visible=t,void(this.isHighlighted=t);t&&(this.highlightedOverlay.visible=t),this.isHighlighted=t;var i=t?1:.1;this.highlightedOverlay.scale.x===i?this.highlightedOverlay.visible=t:(this.highlightedOverlay.scale.x=this.highlightedOverlay.scale.y=t?.1:1,this.engine.moveEngine.addTween(this.highlightedOverlay.scale,.5,{x:i,y:i},0,"linear",!0,this.onHighlightTweenEnd_binded))}},i.prototype.onHighlightTweenEnd=function(){this.highlightedOverlay.visible=this.isHighlighted},i.prototype.destroy=function(){this.engine&&(this.engine&&this.engine.moveEngine&&this.engine.moveEngine.killTweensOf(this.highlightedOverlay.scale),this.engine=null,this.highlightedOverlay=null,this.tileGraphics=null)},i}(e.Container),S=function(t,e,i,n){return i*t/n+e},A=function(t,e,i,n){return i*(t/=n)*t+e},F=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},x=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},L=function(){function t(t,i){void 0===i&&(i=3),this.activeForMovables=!1,this.activeForTweens=!1,this.processFrame=!0,this.movables=[],this.tweenTargets=[],this.fps=60,this.engine=t,this.DEFAULT_SPEED=i,this.processFunc=this.run.bind(this),this.ticker=new e.Ticker,this.ticker.add(this.processFunc),this.ticker.start()}return t.prototype.addTween=function(t,e,i,n,o,r,a){void 0===n&&(n=0),void 0===o&&(o="linear"),void 0===r&&(r=!1),void 0===a&&(a=null);var s,h=null;for(var l in i)t[l]!==i[l]&&(h||(h={}),h[l]={b:t[l],c:i[l]-t[l]});if(h){var c={target:t,duration:e,delay:Number(n)||0,easingFunc:(s=o,"easeInOut"===s||"easeInOutQuad"===s||"Quad.easeInOut"===s?x:"easeIn"===s||"easeInQuad"===s||"Quad.easeIn"===s?A:"easeOut"===s||"easeOutQuad"===s||"Quad.easeOut"===s?F:S),overwrite:r||!1,onComplete:a||null,totalFrames:e*this.fps,currentFrame:0,vars:h};if(this.tweenTargets.indexOf(t)>=0){var g=t.tweens;if(g||(g=[]),c.overwrite){for(var p=0;p<g.length;p++)g[p]=null;g=[]}g[g.length]=c,t.tweens=g}else t.tweens=[c],this.tweenTargets[this.tweenTargets.length]=t;this.tweenTargets.length>0&&!this.activeForTweens&&(this.activeForTweens=!0)}},t.prototype.removeTween=function(t,e){var i=!1;if(t&&e){var n=this.tweenTargets.indexOf(t);if(!(n>=0))throw new Error("No tween target defined for this object");if(!(this.tweenTargets[n].tweens&&this.tweenTargets[n].tweens.length>0))throw new Error("No tween defined for this object");var o=this.tweenTargets[n].tweens,r=o.indexOf(e);if(!(r>=0))throw new Error("No tween defined for this object");e.onComplete=null,e.easingFunc=null,e.target=null,o.splice(r,1),0===o.length&&(this.tweenTargets.splice(n,1),i=!0),0===this.tweenTargets.length&&(this.activeForTweens=!1)}return i},t.prototype.killTweensOf=function(t){var e=!1,i=this.tweenTargets.indexOf(t);if(i>=0){if(this.tweenTargets[i].tweens&&this.tweenTargets[i].tweens.length>0){for(var n=this.tweenTargets[i].tweens,o=0;o<n.length;o++)n[o].onComplete=null,n[o].easingFunc=null,n[o].target=null,n[o]=null;this.tweenTargets[i].tweens=null}this.tweenTargets.splice(i,1),e=!0}return 0===this.tweenTargets.length&&(this.activeForTweens=!1),e},t.prototype.removeAllTweens=function(){var t,e,i;this.activeForTweens=!1;var n=this.tweenTargets.length;for(e=0;e<n;e++){for(t=this.tweenTargets[e].tweens,i=0;i<t.length;i++)t[i].onComplete=null,t[i].easingFunc=null,t[i].target=null,t[i]=null;this.tweenTargets[e].tweens=null,this.tweenTargets[e]=null}this.tweenTargets=[]},t.prototype.addMovable=function(t){this.movables.indexOf(t)>=0||(this.movables[this.movables.length]=t,this.movables.length>0&&!this.activeForMovables&&(this.activeForMovables=!0))},t.prototype.removeMovable=function(t){var e=this.movables.indexOf(t);return-1!==e&&(t.speedUnit={x:0,y:0},this.movables.splice(e,1)),0===this.movables.length&&(this.activeForMovables=!1),-1!==e},t.prototype.removeAllMovables=function(){this.activeForMovables=!1;for(var t=this.movables.length,e=0;e<t;e++)this.movables[e]=null;this.movables=[]},t.prototype.addNewPathToObject=function(t,e,i){t.currentPath&&t.currentTarget&&(e[e.length]=t.currentPath[t.currentPathStep]),t.currentPath=e,t.currentPathStep=t.currentPath.length-1,t.speedMagnitude=i||t.speedMagnitude||this.DEFAULT_SPEED},t.prototype.prepareForMove=function(t,e,i){void 0===i&&(i=null),t.currentPath=e,t.currentPathStep=t.currentPath.length-1,t.speedMagnitude=i||t.speedMagnitude||this.DEFAULT_SPEED},t.prototype.setMoveParameters=function(t,e){var i,n,o=this.engine.getTilePosXFor(e.r,e.c),r=this.engine.getTilePosYFor(e.r,e.c)+this.engine.TILE_HALF_H;t.speedUnit=(i={x:o-t.position.x,y:r-t.position.y},n=Math.sqrt(i.x*i.x+i.y*i.y),{x:i.x/n,y:i.y/n}),t.currentTarget={x:o,y:r},t.currentReachThresh=Math.ceil(Math.sqrt(t.speedUnit.x*t.speedUnit.x+t.speedUnit.y*t.speedUnit.y)*t.speedMagnitude)},t.prototype.run=function(){if(this.processFrame){var t=void 0,e=void 0,i=void 0;if(this.activeForMovables){t=this.movables.length;for(i=0;i<t;i++)(e=this.movables[i]).prevPosition={x:e.position.x,y:e.position.y},e.currentTarget&&h(e.position,e.currentTarget)<=e.currentReachThresh?(e.position.x=e.currentTarget.x,e.position.y=e.currentTarget.y,this.engine.onObjMoveStepEnd(e),i--,t--):(e.position.x+=e.speedMagnitude*e.speedUnit.x,e.position.y+=e.speedMagnitude*e.speedUnit.y,this.engine.checkForTileChange(e),this.engine.checkForFollowCharacter(e))}if(this.activeForTweens){t=this.tweenTargets.length;var n=void 0,o=void 0,r=void 0,a=void 0,s=void 0;for(i=0;i<t;i++)for(r=(o=this.tweenTargets[i]).tweens,a=0;a<r.length;a++){for(var l in(n=r[a]).currentFrame++,s=n.vars)o[l]=n.easingFunc(n.currentFrame,s[l].b,s[l].c,n.totalFrames);n.currentFrame>=n.totalFrames&&(n.onComplete&&n.onComplete(),this.removeTween(o,n)&&(i--,t--),a--)}}}},t.prototype.destroy=function(){C("MoveEngine destroy"),this.processFrame=!1,this.ticker&&this.ticker.stop(),this.removeAllMovables(),this.removeAllTweens(),this.movables=null,this.tweenTargets=null,this.engine=null,this.ticker=null},t}(),M=function(){function t(t,e,i){this.x=t,this.y=e,this.weight=i,this.mapPos={c:t,r:e}}return t.prototype.toString=function(){return"["+String(this.x)+" "+String(this.y)+"]"},t.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},t.prototype.isWall=function(){return 0===this.weight},t}(),k=function(){function t(t){this.content=[],this.scoreFunction=t}return t.prototype.push=function(t){this.content.push(t),this.sinkDown(this.content.length-1)},t.prototype.pop=function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},t.prototype.size=function(){return this.content.length},t.prototype.rescoreElement=function(t){this.sinkDown(this.content.indexOf(t))},t.prototype.sinkDown=function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[i]=e,this.content[t]=n,t=i}},t.prototype.bubbleUp=function(t){for(var e=this.content.length,i=this.content[t],n=this.scoreFunction(i),o=!0;o;){var r=t+1<<1,a=r-1,s=null,h=void 0;if(a<e){var l=this.content[a];(h=this.scoreFunction(l))<n&&(s=a)}if(r<e){var c=this.content[r];this.scoreFunction(c)<(null===s?n:h)&&(s=r)}if(null===s){o=!1;break}this.content[t]=this.content[s],this.content[s]=i,t=s}},t}(),H=function(){function t(e,i,n){void 0===n&&(n={}),this.nodes=[],this.diagonal=!!n.diagonal,this.heuristic=this.diagonal?t.heuristics.diagonal:t.heuristics.manhattan,this.closest=!!n.closest,this.grid=[];var o,r=0,a=0;for(r=0;r<e;r++)for(this.grid[r]=[],a=0;a<i;a++)o=new M(r,a,1),this.grid[r][a]=o,this.nodes.push(o);this.init()}return t.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)this.cleanNode(this.nodes[t])},t.prototype.markDirty=function(t){this.dirtyNodes.push(t)},t.prototype.neighbors=function(t){var e=[],i=t.x,n=t.y,o=this.grid;return o[i-1]&&o[i-1][n]&&e.push(o[i-1][n]),o[i+1]&&o[i+1][n]&&e.push(o[i+1][n]),o[i]&&o[i][n-1]&&e.push(o[i][n-1]),o[i]&&o[i][n+1]&&e.push(o[i][n+1]),this.diagonal&&(o[i-1]&&o[i-1][n-1]&&e.push(o[i-1][n-1]),o[i+1]&&o[i+1][n-1]&&e.push(o[i+1][n-1]),o[i-1]&&o[i-1][n+1]&&e.push(o[i-1][n+1]),o[i+1]&&o[i+1][n+1]&&e.push(o[i+1][n+1])),e},t.prototype.toString=function(){var t,e,i,n,o,r,a=[],s=this.grid;for(i=0,n=s.length;i<n;i++){for(t=[],o=0,r=(e=s[i]).length;o<r;o++)t.push(e[o].weight);a.push(t.join(" "))}return a.join("\n")},t.prototype.solve=function(t,e,i,n){var o=this.grid[t][e],r=this.grid[i][n],a=this.search(o,r,{heuristic:this.heuristic,closest:this.closest});return a&&a.length>0?a:null},t.prototype.getAdjacentOpenCells=function(t,e,i,n){var o,r,a=[];for(o=e;o>e-n;o--)for(r=t;r<t+i;r++)a=a.concat(this.neighbors(this.grid[r][o]));return a},t.prototype.pathTo=function(t){for(var e=t,i=[];e.parent;)i.push(e),e=e.parent;return i},t.prototype.getHeap=function(){return new k((function(t){return t.f}))},t.prototype.search=function(e,i,n){void 0===n&&(n={}),this.init();var o=n.heuristic||t.heuristics.manhattan,r=n.closest||!1,a=this.getHeap(),s=e;for(e.h=o(e,i),a.push(e);a.size()>0;){var h=a.pop();if(h===i)return this.pathTo(h);h.closed=!0;for(var l=this.neighbors(h),c=0,g=l.length;c<g;++c){var p=l[c];if(!p.closed&&!p.isWall()){var u=h.g+p.getCost(h),f=p.visited;(!f||u<p.g)&&(p.visited=!0,p.parent=h,p.h=p.h||o(p,i),p.g=u,p.f=p.g+p.h,this.markDirty(p),r&&(p.h<s.h||p.h===s.h&&p.g<s.g)&&(s=p),f?a.rescoreElement(p):a.push(p))}}}return r?this.pathTo(s):[]},t.prototype.cleanNode=function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null},t.prototype.isCellFilled=function(t,e){return 0===this.grid[t][e].weight},t.prototype.setCell=function(t,e,i){this.grid[t][e].staticWeight=this.grid[t][e].weight=i},t.prototype.setDynamicCell=function(t,e,i){0!==this.grid[t][e].staticWeight&&(this.grid[t][e].weight=i)},t.prototype.destroy=function(){C("PathFinding destroy"),this.grid=null,this.nodes=null,this.dirtyNodes=null,this.heuristic=null},t.heuristics={manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var i=Math.sqrt(2),n=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);return 1*(n+o)+(i-2)*Math.min(n,o)}},t}(),I=function(t){function i(e){var n=t.call(this)||this;return n.posFrame={x:0,y:0,w:800,h:600},n.dragging=!1,n.onMouseUp_binded=n.onMouseUp.bind(n),n.onMouseDown_binded=n.onMouseDown.bind(n),n.onMouseMove_binded=n.onMouseMove.bind(n),n.config=e,n.config.followCharacter=!r(n.config.followCharacter)||n.config.followCharacter,n.config.changeTransparencies=!r(n.config.changeTransparencies)||n.config.changeTransparencies,n.config.highlightPath=!r(n.config.highlightPath)||n.config.highlightPath,n.config.highlightTargetTile=!r(n.config.highlightTargetTile)||n.config.highlightTargetTile,n.config.tileHighlightAnimated=!r(n.config.tileHighlightAnimated)||n.config.tileHighlightAnimated,n.config.tileHighlightFillColor=r(n.config.tileHighlightFillColor)?n.config.tileHighlightFillColor:8443903,n.config.tileHighlightFillAlpha=r(n.config.tileHighlightFillAlpha)?n.config.tileHighlightFillAlpha:.5,n.config.tileHighlightStrokeColor=r(n.config.tileHighlightStrokeColor)?n.config.tileHighlightStrokeColor:16777215,n.config.tileHighlightStrokeAlpha=r(n.config.tileHighlightStrokeAlpha)?n.config.tileHighlightStrokeAlpha:1,n.config.dontAutoMoveToTile=!!r(n.config.dontAutoMoveToTile)&&n.config.dontAutoMoveToTile,n.config.checkPathOnEachTile=!r(n.config.checkPathOnEachTile)||n.config.checkPathOnEachTile,n.config.mapDraggable=!r(n.config.mapDraggable)||n.config.mapDraggable,n.config.isoAngle=r(n.config.isoAngle)?n.config.isoAngle:i.DEFAULT_ISO_ANGLE,n.config.tileHeight=r(n.config.tileHeight)?n.config.tileHeight:i.DEFAULT_TILE_H,n.setZoomParameters(n.config.minScale,n.config.maxScale,n.config.numberOfZoomLevels,n.config.initialZoomLevel,n.config.instantCameraZoom),n.TILE_HALF_H=n.config.tileHeight/2,n.TILE_HALF_W=n.TILE_HALF_H*Math.tan((90-n.config.isoAngle)*Math.PI/180),n.loadAssetsAndData(),n}return n(i,t),i.prototype.loadAssetsAndData=function(){if(!this.config.mapDataPath)throw new Error("TRAVISO: No JSON-file path defined for map data. Please check your configuration object that you pass to the 'getEngineInstance' method.");if("json"!==this.config.mapDataPath.split(".").pop())throw new Error("TRAVISO: Invalid map-data file path. This file has to be a json file.");var t=new e.Loader;t.add("mapData",this.config.mapDataPath),this.config.assetsToLoad&&this.config.assetsToLoad.length>0&&t.add(this.config.assetsToLoad),t.load(this.assetsAndDataLoaded.bind(this))},i.prototype.assetsAndDataLoaded=function(t){var e,i,n,o=t.resources.mapData.data;r(o.initialControllableLocation)?r(o.initialControllableLocation.columnIndex)&&r(o.initialControllableLocation.rowIndex)||(C("Map-data file warning: 'initialControllableLocation' exists but it is not defined properly."),o.initialControllableLocation=null):C("Map-data file warning: No 'initialControllableLocation' defined. Ignore this warning if you are adding it later manually."),o.tileHighlightImage&&!o.tileHighlightImage.path&&(C("Map-data file warning: 'tileHighlightImage' exists but its 'path' is not defined properly."),o.tileHighlightImage=null),o.singleGroundImage&&!o.singleGroundImage.path&&(C("Map-data file warning: 'singleGroundImage' exists but its 'path' is not defined properly."),o.singleGroundImage=null);var a,s,h,l,c,g,p,u,f=o.groundMap;for(o.groundMapData=[],e=0;e<f.length;e++){for(i=(n=String(f[e].row).replace(/\s/g,"").split(",")).length;i--;)n[i]=n[i]||"0";o.groundMapData[e]=n}for(f=o.objectsMap,o.objectsMapData=[],e=0;e<f.length;e++){for(i=(n=String(f[e].row).replace(/\s/g,"").split(",")).length;i--;)n[i]=n[i]||"0";o.objectsMapData[e]=n}for(s in r(o.tiles)||(C("Map-data file warning: No 'tiles' defined."),o.tiles={}),r(o.objects)||(C("Map-data file warning: No 'objects' defined."),o.objects={}),o.objects){if(a=o.objects[s],!r(a.visuals))throw new Error("TRAVISO: No visuals defined in data-file for object type: "+s);for(l in a.id=s,r(a.rowSpan)||(a.rowSpan=1),r(a.columnSpan)||(a.columnSpan=1),g={},c={},a.visuals)if(h=a.visuals[l],r(h.ipor)&&r(h.ipoc)&&(c[l]={c:Number(h.ipoc),r:Number(h.ipor)}),h.frames&&h.frames.length>0)for(g[l]=[],p=0;p<h.frames.length;p++)g[l][p]=h.frames[p].path;else{if(!h.path||!h.extension||!h.numberOfFrames||h.numberOfFrames<1)throw new Error("TRAVISO: Invalid or missing visual attributes detected in data-file for visual with id: "+l);if(g[l]=[],1===h.numberOfFrames)g[l][0]=h.path+"."+h.extension;else for(u=0,p=h.startIndex;p<h.numberOfFrames;p++)g[l][u++]=h.path+String(p)+"."+h.extension}a.textureNames=g,a.io=c,a.f=!!a.floor,a.nt=!!a.noTransparency,a.m=!!a.movable,a.i=!!a.interactive}delete o.objectsMap,delete o.groundMap,this.mapData=o,this.onAllAssetsLoaded()},i.prototype.onAllAssetsLoaded=function(){C("All assets loaded"),this.moveEngine=new L(this),this.currentScale=1,this.currentZoom=0,this.posFrame=this.config.initialPositionFrame||{x:0,y:0,w:800,h:600},this.externalCenter={x:this.posFrame.w>>1,y:this.posFrame.h>>1},this.createMap(),this.repositionContent(this.config.initialPositionFrame),this.enableInteraction(),this.config.engineInstanceReadyCallback&&this.config.engineInstanceReadyCallback(this)},i.prototype.createMap=function(){this.config.backgroundColor&&(this.bg=new e.Graphics,this.addChild(this.bg)),this.config.useMask&&(this.mapMask=new e.Graphics,this.addChild(this.mapMask)),this.mapContainer=new e.Container,this.addChild(this.mapContainer),this.groundContainer=new e.Container,this.mapContainer.addChild(this.groundContainer),this.objContainer=new e.Container,this.mapContainer.addChild(this.objContainer);var t,i,n,o,r=this.mapData.groundMapData,a=this.mapData.objectsMapData,s=this.mapData.initialControllableLocation;for(this.mapSizeR=r.length,this.mapSizeC=r[0].length,this.mapData.singleGroundImage&&(t=new e.Sprite(e.Texture.from(this.mapData.singleGroundImage.path)),this.groundContainer.addChild(t),t.scale.set(this.mapData.singleGroundImage.scale||1)),this.tileArray=[],this.objArray=[],i=0;i<this.mapSizeR;i++)for(this.tileArray[i]=[],this.objArray[i]=[],n=0;n<this.mapSizeC;n++)this.tileArray[i][n]=null,this.objArray[i][n]=null;for(this.pathFinding=new H(this.mapSizeC,this.mapSizeR,{diagonal:this.config.pathFindingType===y,closest:this.config.pathFindingClosest}),i=0;i<this.mapSizeR;i++)for(n=this.mapSizeC-1;n>=0;n--)this.tileArray[i][n]=null,r[i][n]&&"0"!==r[i][n]?((o=new j(this,r[i][n])).position.x=this.getTilePosXFor(i,n),o.position.y=this.getTilePosYFor(i,n),o.mapPos={c:n,r:i},this.tileArray[i][n]=o,this.groundContainer.addChild(o),o.isMovableTo||this.pathFinding.setCell(n,i,0)):this.pathFinding.setCell(n,i,0);var h,l=!1;for(i=0;i<this.mapSizeR;i++)for(n=this.mapSizeC-1;n>=0;n--)this.objArray[i][n]=null,a[i][n]&&"0"!==a[i][n]&&((h=new P(this,a[i][n])).position.x=this.getTilePosXFor(i,n),h.position.y=this.getTilePosYFor(i,n)+this.TILE_HALF_H,h.mapPos={c:n,r:i},!l&&h.isFloorObject&&(l=!0),this.objContainer.addChild(h),this.addObjRefToLocation(h,h.mapPos),s&&s.columnIndex===n&&s.rowIndex===i&&(this.currentControllable=h));if(l){var c=void 0,g=void 0;for(i=0;i<this.mapSizeR;i++)for(n=this.mapSizeC-1;n>=0;n--)if(c=this.objArray[i][n])for(g=0;g<c.length;g++)c[g].isFloorObject||this.objContainer.addChild(c[g])}this.mapVertices=[[this.getTilePosXFor(0,0)-this.TILE_HALF_W,this.getTilePosYFor(0,0)],[this.getTilePosXFor(0,this.mapSizeC-1),this.getTilePosYFor(0,this.mapSizeC-1)-this.TILE_HALF_H],[this.getTilePosXFor(this.mapSizeR-1,this.mapSizeC-1)+this.TILE_HALF_W,this.getTilePosYFor(this.mapSizeR-1,this.mapSizeC-1)],[this.getTilePosXFor(this.mapSizeR-1,0),this.getTilePosYFor(this.mapSizeR-1,0)+this.TILE_HALF_H]],this.mapVisualWidthReal=this.getTilePosXFor(this.mapSizeR-1,this.mapSizeC-1)-this.getTilePosXFor(0,0),this.mapVisualHeightReal=this.getTilePosYFor(this.mapSizeR-1,0)-this.getTilePosYFor(0,this.mapSizeC-1),t&&(t.position.x=this.mapVertices[0][0]+this.TILE_HALF_W+(this.mapVisualWidthReal-t.width)/2,t.position.y=this.mapVertices[1][1]+this.TILE_HALF_H+(this.mapVisualHeightReal-t.height)/2),this.zoomTo(this.config.initialZoomLevel,!0),this.config.followCharacter&&s?this.centralizeToLocation(s.columnIndex,s.rowIndex,!0):this.centralizeToCurrentExternalCenter(!0)},i.prototype.getTilePosXFor=function(t,e){return e*this.TILE_HALF_W+t*this.TILE_HALF_W},i.prototype.getTilePosYFor=function(t,e){return t*this.TILE_HALF_H-e*this.TILE_HALF_H},i.prototype.showHideObjectLayer=function(t){void 0===t&&(t=!1),this.objContainer.visible=t},i.prototype.showHideGroundLayer=function(t){void 0===t&&(t=!1),this.groundContainer.visible=t},i.prototype.getTileAtRowAndColumn=function(t,e){return this.tileArray[t][e]},i.prototype.getObjectsAtRowAndColumn=function(t,e){return this.objArray[t][e]},i.prototype.getObjectsAtLocation=function(t){return this.objArray[t.r][t.c]},i.prototype.createAndAddObjectToLocation=function(t,e){return this.addObjectToLocation(new P(this,t),e)},i.prototype.addObjectToLocation=function(t,e){return t.position.x=this.getTilePosXFor(e.r,e.c),t.position.y=this.getTilePosYFor(e.r,e.c)+this.TILE_HALF_H,t.mapPos={c:e.c,r:e.r},this.objContainer.addChild(t),this.addObjRefToLocation(t,t.mapPos),this.arrangeDepthsFromLocation(t.isFloorObject?{c:this.mapSizeC-1,r:0}:t.mapPos),t},i.prototype.addCustomObjectToLocation=function(t,e){return t.isMovableTo=!r(t.isMovableTo)||t.isMovableTo,t.columnSpan=t.columnSpan||1,t.rowSpan=t.rowSpan||1,this.addObjectToLocation(t,e)},i.prototype.removeObjectFromLocation=function(t,e){e=e||t.mapPos,this.objContainer.removeChild(t),this.removeObjRefFromLocation(t,e)},i.prototype.focusMapToObject=function(t){this.focusMapToLocation(t.mapPos.c+(t.columnSpan-1)/2,t.mapPos.r-(t.rowSpan-1)/2,0)},i.prototype.focusMapToLocation=function(t,e,i){this.zoomTo(i,!1),this.centralizeToLocation(t,e,this.config.instantCameraRelocation)},i.prototype.centralizeToObject=function(t){this.centralizeToLocation(t.mapPos.c,t.mapPos.r,this.config.instantCameraRelocation)},i.prototype.centralizeToLocation=function(t,e,i){this.currentFocusLocation={c:t,r:e};var n=this.externalCenter.x+(this.mapVisualWidthScaled>>1)-this.getTilePosXFor(e,t)*this.currentScale,o=this.externalCenter.y-this.getTilePosYFor(e,t)*this.currentScale;this.centralizeToPoint(n,o,i)},i.prototype.centralizeToCurrentFocusLocation=function(t){this.centralizeToLocation(this.currentFocusLocation.c,this.currentFocusLocation.r,t)},i.prototype.centralizeToCurrentExternalCenter=function(t){this.externalCenter&&(this.currentFocusLocation={c:this.mapSizeC>>1,r:this.mapSizeR>>1},this.centralizeToPoint(this.externalCenter.x,this.externalCenter.y,t))},i.prototype.centralizeToPoint=function(t,e,i){this.tileArray&&(t-=this.mapVisualWidthScaled>>1,r(i)&&i||!r(i)&&this.config.instantCameraRelocation?(this.mapContainer.position.x=t,this.mapContainer.position.y=e):this.moveEngine.addTween(this.mapContainer.position,.5,{x:t,y:e},0,"easeInOut",!0))},i.prototype.setZoomParameters=function(t,e,i,n,o){void 0===o&&(o=!1),this.config.minScale=r(t)?t:.5,this.config.maxScale=r(e)?e:1.5,this.config.minZoom=-1,this.config.maxZoom=1,this.config.zoomIncrement=r(i)?i<=1?0:2/(i-1):.5,this.config.initialZoomLevel=r(n)?n:0,this.config.instantCameraZoom=!!r(o)&&o},i.prototype.setScale=function(t,e){t<this.config.minScale?t=this.config.minScale:t>this.config.maxScale&&(t=this.config.maxScale),this.currentScale=t,this.mapVisualWidthScaled=this.mapVisualWidthReal*this.currentScale,r(e)&&e||!r(e)&&this.config.instantCameraZoom?this.mapContainer.scale.set(this.currentScale):this.moveEngine.addTween(this.mapContainer.scale,.5,{x:this.currentScale,y:this.currentScale},0,"easeInOut",!0)},i.prototype.zoomTo=function(t,e){var i=a(t=t||0,this.config.minZoom,this.config.maxZoom,this.config.minScale,this.config.maxScale,!0);i=Math.round(10*i)/10,this.currentZoom=a(i,this.config.minScale,this.config.maxScale,this.config.minZoom,this.config.maxZoom,!0),this.externalCenter=this.externalCenter?this.externalCenter:{x:this.mapVisualWidthScaled>>1,y:0};var n=this.mapContainer.position.x+(this.mapVisualWidthScaled>>1)-this.externalCenter.x,o=this.mapContainer.position.y-this.externalCenter.y,s=this.currentScale;this.setScale(i,e);var h=this.currentScale/s;this.centralizeToPoint(this.externalCenter.x+n*h,this.externalCenter.y+o*h,r(e)&&e||!r(e)&&this.config.instantCameraZoom)},i.prototype.zoomOut=function(t){this.zoomTo(this.currentZoom-this.config.zoomIncrement,t)},i.prototype.zoomIn=function(t){this.zoomTo(this.currentZoom+this.config.zoomIncrement,t)},i.prototype.getCurrentControllable=function(){return this.currentControllable},i.prototype.setCurrentControllable=function(t){this.currentControllable=t},i.prototype.addObjRefToLocation=function(t,e){var i,n;for(i=e.c;i<e.c+t.columnSpan;i++)for(n=e.r;n>e.r-t.rowSpan;n--)this.addObjRefToSingleLocation(t,{c:i,r:n})},i.prototype.addObjRefToSingleLocation=function(t,e){this.objArray[e.r][e.c]||(this.objArray[e.r][e.c]=[]),this.objArray[e.r][e.c].indexOf(t)<0&&this.objArray[e.r][e.c].push(t),t.isMovableTo||this.pathFinding.setDynamicCell(e.c,e.r,0)},i.prototype.removeObjRefFromLocation=function(t,e){var i,n;for(i=e.c;i<e.c+t.columnSpan;i++)for(n=e.r;n>e.r-t.rowSpan;n--)this.removeObjRefFromSingleLocation(t,{c:i,r:n})},i.prototype.removeObjRefFromSingleLocation=function(t,e){if(this.objArray[e.r][e.c]){var i=this.objArray[e.r][e.c].indexOf(t);if(i>-1&&this.objArray[e.r][e.c].splice(i,1),0===this.objArray[e.r][e.c].length)this.pathFinding.setDynamicCell(e.c,e.r,1),this.objArray[e.r][e.c]=null;else for(var n=this.objArray[e.r][e.c],o=n.length,r=0;r<o;r++){if(!n[r].isMovableTo){this.pathFinding.setDynamicCell(e.c,e.r,0);break}r===o-1&&this.pathFinding.setDynamicCell(e.c,e.r,1)}}},i.prototype.changeObjAlphasInLocation=function(t,e){var i=this.objArray[e.r][e.c];if(i)for(var n=i.length,o=0;o<n;o++)i[o].isFloorObject||i[o].noTransparency||(i[o].alpha=t)},i.prototype.arrangeObjLocation=function(t,e){this.removeObjRefFromLocation(t,t.mapPos),this.addObjRefToLocation(t,e),t.mapPos={c:e.c,r:e.r}},i.prototype.arrangeObjTransparencies=function(t,e,i){this.config.changeTransparencies&&(this.currentControllable===t&&(e.c>0&&this.changeObjAlphasInLocation(1,{c:e.c-1,r:e.r}),e.c>0&&e.r<this.mapSizeR-1&&this.changeObjAlphasInLocation(1,{c:e.c-1,r:e.r+1}),e.r<this.mapSizeR-1&&this.changeObjAlphasInLocation(1,{c:e.c,r:e.r+1}),i.c>0&&this.changeObjAlphasInLocation(.7,{c:i.c-1,r:i.r}),i.c>0&&i.r<this.mapSizeR-1&&this.changeObjAlphasInLocation(.7,{c:i.c-1,r:i.r+1}),i.r<this.mapSizeR-1&&this.changeObjAlphasInLocation(.7,{c:i.c,r:i.r+1})),t.alpha=1)},i.prototype.arrangeDepthsFromLocation=function(t){var e,i,n,o;for(i=t.r;i<this.mapSizeR;i++)for(n=t.c;n>=0;n--)if(e=this.objArray[i][n])for(o=0;o<e.length;o++)e[o].isFloorObject||this.objContainer.addChild(e[o])},i.prototype.arrangePathHighlight=function(t,e){var i,n;if(t)for(i=0;i<t.length;i++)n=t[i],e&&-1!==e.indexOf(n)||this.tileArray[n.mapPos.r][n.mapPos.c].setHighlighted(!1,!this.config.tileHighlightAnimated);if(e)for(i=0;i<e.length;i++)n=e[i],t&&-1!==t.indexOf(n)||this.tileArray[n.mapPos.r][n.mapPos.c].setHighlighted(!0,!this.config.tileHighlightAnimated)},i.prototype.stopObject=function(t){t.currentPath=null,t.currentTarget=null,t.currentTargetTile=null,this.moveEngine.removeMovable(t)},i.prototype.moveObjThrough=function(t,e,i){if(void 0===i&&(i=null),this.config.instantObjectRelocation){var n=this.tileArray[e[0].mapPos.r][e[0].mapPos.c];t.position.x=n.position.x,t.position.y=n.position.y+this.TILE_HALF_H,this.arrangeObjTransparencies(t,t.mapPos,n.mapPos),this.arrangeObjLocation(t,n.mapPos),this.arrangeDepthsFromLocation(n.mapPos)}else this.config.highlightPath&&this.currentControllable===t&&this.arrangePathHighlight(t.currentPath,e),t.currentTarget&&this.stopObject(t),this.moveEngine.prepareForMove(t,e,i),t.currentTargetTile=t.currentPath[t.currentPathStep],this.onObjMoveStepBegin(t,t.currentPath[t.currentPathStep].mapPos)},i.prototype.onObjMoveStepBegin=function(t,e){var i,n,o,r,a;return t.currentDirection=(i=t.mapPos.r,n=t.mapPos.c,o=e.r,r=e.c,a=c,i===o?a=n===r?l:n<r?d:g:i<o?a=n===r?b:n<r?m:c:i>o&&(a=n===r?u:n<r?f:p),a),t.changeVisualToDirection(t.currentDirection,!0),this.pathFinding.isCellFilled(e.c,e.r)?(this.moveEngine.removeMovable(t),this.checkAndMoveObjectToLocation(t,t.currentPath[0].mapPos),!1):(this.moveEngine.setMoveParameters(t,e),this.moveEngine.addMovable(t),!0)},i.prototype.onObjMoveStepEnd=function(t){t.currentPathStep--,t.currentTarget=null,t.currentTargetTile=null;var e=0>t.currentPathStep;(this.moveEngine.removeMovable(t),e?t.changeVisualToDirection(t.currentDirection,!1):this.config.checkPathOnEachTile?this.checkAndMoveObjectToLocation(t,t.currentPath[0].mapPos):(t.currentPath.splice(t.currentPath.length-1,1),this.moveObjThrough(t,t.currentPath)),this.currentControllable===t)&&this.tileArray[t.mapPos.r][t.mapPos.c].setHighlighted(!1,!this.config.tileHighlightAnimated);e&&this.config.objectReachedDestinationCallback&&this.config.objectReachedDestinationCallback(t)},i.prototype.checkForFollowCharacter=function(t){if(this.config.followCharacter&&this.currentControllable===t){this.currentFocusLocation={c:t.mapPos.c,r:t.mapPos.r};var e=this.externalCenter.x-t.position.x*this.currentScale,i=this.externalCenter.y-t.position.y*this.currentScale;this.moveEngine.addTween(this.mapContainer.position,.1,{x:e,y:i},0,"easeOut",!0)}},i.prototype.checkForTileChange=function(t){this.config.objectUpdateCallback&&this.config.objectUpdateCallback(t);for(var e={x:t.position.x,y:t.position.y-this.TILE_HALF_H},i=this.tileArray[t.currentTargetTile.mapPos.r][t.currentTargetTile.mapPos.c],n=[],o=0;o<i.vertices.length;o++)n[o]=[i.vertices[o][0]+i.position.x,i.vertices[o][1]+i.position.y];if((t.currentTargetTile.mapPos.r!==t.mapPos.r||t.currentTargetTile.mapPos.c!==t.mapPos.c)&&s(e,n)){this.arrangeObjTransparencies(t,t.mapPos,t.currentTargetTile.mapPos),this.arrangeObjLocation(t,t.currentTargetTile.mapPos),this.arrangeDepthsFromLocation(t.mapPos);var r=this.getObjectsAtLocation(t.currentTargetTile.mapPos);r&&r.length>1&&this.config.otherObjectsOnTheNextTileCallback&&this.config.otherObjectsOnTheNextTileCallback(t,r)}},i.prototype.getPath=function(t,e){if(this.pathFinding)return this.pathFinding.solve(t.c,t.r,e.c,e.r);throw new Error("Path finding hasn't been initialized yet!")},i.prototype.checkAndMoveObjectToTile=function(t,e,i){return void 0===i&&(i=null),!!e.isMovableTo&&this.checkAndMoveObjectToLocation(t,e.mapPos,i)},i.prototype.checkAndMoveObjectToLocation=function(t,e,i){void 0===i&&(i=null);var n=this.getPath(t.mapPos,e);return!!n&&(this.moveObjThrough(t,n,i),n.length>0)},i.prototype.moveCurrentControllableToLocation=function(t,e){if(void 0===e&&(e=null),!this.currentControllable)throw new Error("TRAVISO: currentControllable is not defined!");return this.checkAndMoveObjectToLocation(this.currentControllable,t,e)},i.prototype.moveCurrentControllableToObj=function(t,e){if(void 0===e&&(e=null),!this.currentControllable)throw new Error("TRAVISO: currentControllable is not defined!");if(t.currentInteractionOffset){var i={c:t.mapPos.c+t.currentInteractionOffset.c,r:t.mapPos.r+t.currentInteractionOffset.r};if(this.checkAndMoveObjectToLocation(this.currentControllable,i,e))return!0}for(var n,o,r,a,s=this.pathFinding.getAdjacentOpenCells(t.mapPos.c,t.mapPos.r,t.columnSpan,t.rowSpan),h=3e3,l=0;l<s.length;l++)if(n=this.tileArray[s[l].mapPos.r][s[l].mapPos.c]){if(n.mapPos.c===this.currentControllable.mapPos.c&&n.mapPos.r===this.currentControllable.mapPos.r)return this.arrangePathHighlight(this.currentControllable.currentPath,null),this.stopObject(this.currentControllable),a=this.config.instantObjectRelocation,this.config.instantObjectRelocation=!0,this.moveObjThrough(this.currentControllable,[new M(n.mapPos.c,n.mapPos.r,1)]),this.config.instantObjectRelocation=a,this.currentControllable.changeVisualToDirection(this.currentControllable.currentDirection,!1),this.config.objectReachedDestinationCallback&&this.config.objectReachedDestinationCallback(this.currentControllable),!0;(o=this.getPath(this.currentControllable.mapPos,n.mapPos))&&o.length<h&&(h=o.length,r=o)}return!!r&&(this.moveObjThrough(this.currentControllable,r,e),!0)},i.prototype.getTileFromLocalPos=function(t){var e=null;if(s(t,this.mapVertices)){var i=this.TILE_HALF_W/2,n=void 0,o=void 0,r=void 0,a=void 0,l=3e3;for(o=0;o<this.mapSizeR;o++)for(r=0;r<this.mapSizeC&&!((n=this.tileArray[o][r])&&(a=h(t,n.position))<l&&(l=a,e=n,a<i));r++);}return e},i.prototype.checkForTileClick=function(t){var e=this.mapContainer.toLocal(t.global),i=this.getTileFromLocalPos(e);if(i){var n=this.objArray[i.mapPos.r][i.mapPos.c];if(n)for(var o=0;o<n.length;o++){if(n[o].isInteractive){this.config.objectSelectCallback&&this.config.objectSelectCallback(n[o]);break}if(n[o].isMovableTo&&(this.config.dontAutoMoveToTile||!this.currentControllable||this.checkAndMoveObjectToTile(this.currentControllable,i))){this.config.highlightTargetTile&&i.setHighlighted(!0,!this.config.tileHighlightAnimated),this.config.tileSelectCallback&&this.config.tileSelectCallback(i.mapPos.r,i.mapPos.c);break}}else(this.config.dontAutoMoveToTile||!this.currentControllable||this.checkAndMoveObjectToTile(this.currentControllable,i))&&(this.config.highlightTargetTile&&i.setHighlighted(!0,!this.config.tileHighlightAnimated),this.config.tileSelectCallback&&this.config.tileSelectCallback(i.mapPos.r,i.mapPos.c))}},i.prototype.enableInteraction=function(){this.on("pointerdown",this.onMouseDown_binded).on("pointerup",this.onMouseUp_binded).on("pointerupoutside",this.onMouseUp_binded).on("pointermove",this.onMouseMove_binded),this.interactive=!0},i.prototype.disableInteraction=function(){this.off("pointerdown",this.onMouseDown_binded).off("pointerup",this.onMouseUp_binded).off("pointerupoutside",this.onMouseUp_binded).off("pointermove",this.onMouseMove_binded),this.interactive=!0,this.dragging=!1},i.prototype.isInteractionInMask=function(t){return!this.config.useMask||!(t.x<this.posFrame.x||t.y<this.posFrame.y||t.x>this.posFrame.x+this.posFrame.w||t.y>this.posFrame.y+this.posFrame.h)},i.prototype.onMouseDown=function(t){var e=t.data.global;!this.dragging&&this.isInteractionInMask(e)&&(this.dragging=!0,this.dragInitStartingX=this.dragPrevStartingX=e.x,this.dragInitStartingY=this.dragPrevStartingY=e.y)},i.prototype.onMouseMove=function(t){if(this.dragging&&this.config.mapDraggable){var e=t.data.global;this.mapContainer.position.x+=e.x-this.dragPrevStartingX,this.mapContainer.position.y+=e.y-this.dragPrevStartingY,this.dragPrevStartingX=e.x,this.dragPrevStartingY=e.y}},i.prototype.onMouseUp=function(t){if(this.dragging){this.dragging=!1;var e=t.data.global.x-this.dragInitStartingX,i=t.data.global.y-this.dragInitStartingY;Math.abs(e)<5&&Math.abs(i)<5&&this.checkForTileClick(t.data)}},i.prototype.repositionContent=function(t){void 0===t&&(t=null),C("EngineView repositionContent"),t=t||this.posFrame||{x:0,y:0,w:800,h:600},this.position.x=t.x,this.position.y=t.y,this.externalCenter={x:t.w>>1,y:t.h>>1},this.centralizeToCurrentFocusLocation(!0),this.bg&&(this.bg.clear(),this.bg.beginFill(this.config.backgroundColor,1),this.bg.drawRect(0,0,t.w,t.h),this.bg.endFill()),this.mapMask&&this.mapContainer&&(this.mapMask.clear(),this.mapMask.beginFill(0),this.mapMask.drawRect(0,0,t.w,t.h),this.mapMask.endFill(),this.mapContainer.mask=this.mapMask),this.posFrame=t},i.prototype.destroy=function(){var t,e,i,n;for(C("EngineView destroy"),this.disableInteraction(),this.moveEngine.destroy(),this.moveEngine=null,e=0;e<this.mapSizeR;e++)for(i=this.mapSizeC-1;i>=0;i--){if((t=this.tileArray[e][i])&&t.destroy(),this.tileArray[e][i]=null,t=this.objArray[e][i])for(n=0;n<t.length;n++)t[n]&&t[n].destroy(),t[n]=null;this.objArray[e][i]=null}t=null,this.pathFinding.destroy(),this.pathFinding=null,this.currentControllable=null,this.tileArray=null,this.objArray=null,this.bg=null,this.groundContainer=null,this.objContainer=null,this.mapContainer&&(this.mapContainer.mask=null,this.removeChild(this.mapContainer),this.mapContainer=null),this.mapMask&&(this.removeChild(this.mapMask),this.mapMask=null),this.config=null,this.mapData.groundMapData=null,this.mapData.objectsMapData=null,this.mapData.objects=null,this.mapData.tiles=null,this.mapData=null},Object.defineProperty(i.prototype,"instantCameraZoom",{get:function(){return this.config.instantCameraZoom},set:function(t){this.config.instantCameraZoom=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"followCharacter",{get:function(){return this.config.followCharacter},set:function(t){this.config.followCharacter=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"instantCameraRelocation",{get:function(){return this.config.instantCameraRelocation},set:function(t){this.config.instantCameraRelocation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"instantObjectRelocation",{get:function(){return this.config.instantObjectRelocation},set:function(t){this.config.instantObjectRelocation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changeTransparencies",{get:function(){return this.config.changeTransparencies},set:function(t){this.config.changeTransparencies=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightPath",{get:function(){return this.config.highlightPath},set:function(t){this.config.highlightPath=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightTargetTile",{get:function(){return this.config.highlightTargetTile},set:function(t){this.config.highlightTargetTile=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileHighlightAnimated",{get:function(){return this.config.tileHighlightAnimated},set:function(t){this.config.tileHighlightAnimated=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dontAutoMoveToTile",{get:function(){return this.config.dontAutoMoveToTile},set:function(t){this.config.dontAutoMoveToTile=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkPathOnEachTile",{get:function(){return this.config.checkPathOnEachTile},set:function(t){this.config.checkPathOnEachTile=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mapDraggable",{get:function(){return this.config.mapDraggable},set:function(t){this.config.mapDraggable=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"engineInstanceReadyCallback",{get:function(){return this.config.engineInstanceReadyCallback},set:function(t){this.config.engineInstanceReadyCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileSelectCallback",{get:function(){return this.config.tileSelectCallback},set:function(t){this.config.tileSelectCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"objectSelectCallback",{get:function(){return this.config.objectSelectCallback},set:function(t){this.config.objectSelectCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"objectReachedDestinationCallback",{get:function(){return this.config.objectReachedDestinationCallback},set:function(t){this.config.objectReachedDestinationCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"otherObjectsOnTheNextTileCallback",{get:function(){return this.config.otherObjectsOnTheNextTileCallback},set:function(t){this.config.otherObjectsOnTheNextTileCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"objectUpdateCallback",{get:function(){return this.config.objectUpdateCallback},set:function(t){this.config.objectUpdateCallback=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileHighlightStrokeAlpha",{get:function(){return this.config.tileHighlightStrokeAlpha},set:function(t){this.config.tileHighlightStrokeAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileHighlightStrokeColor",{get:function(){return this.config.tileHighlightStrokeColor},set:function(t){this.config.tileHighlightStrokeColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileHighlightFillAlpha",{get:function(){return this.config.tileHighlightFillAlpha},set:function(t){this.config.tileHighlightFillAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tileHighlightFillColor",{get:function(){return this.config.tileHighlightFillColor},set:function(t){this.config.tileHighlightFillColor=t},enumerable:!1,configurable:!0}),i.DEFAULT_TILE_H=74,i.DEFAULT_ISO_ANGLE=30,i}(e.Container),_=!1;function E(){var t;if(!_){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c Traviso.js - 0.1.4  %c  %c  http://www.travisojs.com/  %c  \n\n","background: #18bc9c; padding:5px 0;","background: #18bc9c; padding:5px 0;","color: #18bc9c; background: #030307; padding:5px 0;","background: #18bc9c; padding:5px 0;","background: #5ad2ba; padding:5px 0;","background: #18bc9c; padding:5px 0;"];(t=self.console).log.apply(t,e)}else self.console&&self.console.log("Traviso.js 0.1.4 - http://www.travisojs.com/");_=!0}}var D="0.1.4",R={logEnabled:!1},z=!1;return t.EngineView=I,t.VERSION=D,t.enableDisableLogging=w,t.getEngineInstance=function(t,e){return void 0===e&&(e=null),function(t){t&&((R=o(o({},R),t)).logEnabled=w(t.logEnabled)),z||(z=!0,E(),C("Traviso initiated. (Version: 0.1.4)"))}(e),new I(t)},t.sayHello=E,t.skipHello=function(){_=!0},t.trace=C,Object.defineProperty(t,"__esModule",{value:!0}),t}({},PIXI);
//# sourceMappingURL=traviso.min.js.map
